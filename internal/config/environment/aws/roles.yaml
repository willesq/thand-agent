version: "1.0"
roles:
  # Read-Only Access
  aws_readonly:
    name: AWS Read-Only
    description: Read-only access to AWS resources across all services
    workflows: 
      - aws_simple_elevation
    inherits:
      - arn:aws:iam::aws:policy/ReadOnlyAccess
    permissions:
      allow:
        - ec2:Describe*
        - s3:Get*
        - s3:List*
        - rds:Describe*
        - lambda:Get*
        - lambda:List*
        - cloudwatch:Describe*
        - cloudwatch:Get*
        - cloudwatch:List*
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Administrator Access
  aws_admin:
    name: AWS Administrator
    description: Full administrative access to all AWS resources
    workflows: 
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/AdministratorAccess
    permissions:
      allow:
        - "*:*"
    scopes:
      groups:
        - oidc:admins
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Secrets Manager Access
  aws_secrets_manager:
    name: AWS Secrets Manager
    description: Full access to AWS Secrets Manager for managing secrets
    workflows:
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/SecretsManagerReadWrite
    permissions:
      allow:
        - secretsmanager:*
        - kms:Decrypt
        - kms:Encrypt
        - kms:DescribeKey
    scopes:
      groups:
        - oidc:security
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Database Administrator
  aws_database_admin:
    name: AWS Database Administrator
    description: Full access to RDS, DynamoDB, and database services
    workflows:
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/AmazonRDSFullAccess
      - arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess
    permissions:
      allow:
        - rds:*
        - dynamodb:*
        - elasticache:*
        - redshift:*
    scopes:
      groups:
        - oidc:database-admins
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Storage Administrator
  aws_storage_admin:
    name: AWS Storage Administrator
    description: Full access to S3, EFS, and storage services
    workflows:
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/AmazonS3FullAccess
      - arn:aws:iam::aws:policy/AmazonElasticFileSystemFullAccess
    permissions:
      allow:
        - s3:*
        - efs:*
        - fsx:*
        - backup:*
    scopes:
      groups:
        - oidc:storage-admins
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Network Administrator
  aws_network_admin:
    name: AWS Network Administrator
    description: Full access to VPC, networking, and connectivity services
    workflows:
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/job-function/NetworkAdministrator
    permissions:
      allow:
        - ec2:*Vpc*
        - ec2:*Subnet*
        - ec2:*Gateway*
        - ec2:*Route*
        - ec2:*NetworkAcl*
        - ec2:*SecurityGroup*
        - route53:*
        - elasticloadbalancing:*
    scopes:
      groups:
        - oidc:network-admins
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Security Auditor
  aws_security_auditor:
    name: AWS Security Auditor
    description: Read access to security-related services and audit logs
    workflows:
      - aws_simple_elevation
    inherits:
      - arn:aws:iam::aws:policy/SecurityAudit
    permissions:
      allow:
        - iam:Get*
        - iam:List*
        - cloudtrail:*
        - guardduty:Get*
        - guardduty:List*
        - securityhub:Get*
        - config:Describe*
    scopes:
      groups:
        - oidc:security
        - oidc:compliance
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Compute Administrator
  aws_compute_admin:
    name: AWS Compute Administrator
    description: Full access to EC2, Lambda, ECS, and compute services
    workflows:
      - aws_email_approval
    inherits:
      - arn:aws:iam::aws:policy/AmazonEC2FullAccess
      - arn:aws:iam::aws:policy/AWSLambda_FullAccess
    permissions:
      allow:
        - ec2:*
        - lambda:*
        - ecs:*
        - eks:*
        - ecr:*
        - autoscaling:*
    scopes:
      groups:
        - oidc:compute-admins
        - oidc:devops
    providers:
      - ${AWS_PROVIDER}
    enabled: true

  # Developer Access
  aws_developer:
    name: AWS Developer
    description: Developer access with limited permissions
    workflows:
      - aws_simple_elevation
    inherits:
      - arn:aws:iam::aws:policy/PowerUserAccess
    permissions:
      allow:
        - ec2:*
        - s3:*
        - lambda:*
        - dynamodb:*
        - sqs:*
        - sns:*
        - cloudwatch:*
        - logs:*
      deny:
        - iam:*
        - organizations:*
    scopes:
      groups:
        - oidc:developers
        - oidc:eng
    providers:
      - ${AWS_PROVIDER}
    enabled: true

